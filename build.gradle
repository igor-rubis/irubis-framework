/**
 * Copyright 2016 Igor Rubis
 * Licensed under the Apache License, Version 2.0
 */

group 'com.irubis_framework'
version '1.0-SNAPSHOT'

apply plugin: 'groovy'
apply plugin: 'java'

repositories {
    mavenCentral()
}

configurations {
    agent
}

dependencies {
    agent "org.aspectj:aspectjweaver:${aspectjVersion}"
    compile     group: 'org.hamcrest',              name: 'hamcrest-core',          version: '1.3'
    compile     group: 'org.codehaus.groovy',       name: 'groovy-all',             version: '2.3.11'
    compile     group: 'org.seleniumhq.selenium',   name: 'selenium-java',          version: '2.53.0'
    compile     group: 'ru.yandex.qatools.allure',  name: 'allure-junit-adaptor',   version: "${allureVersion}"
    compile     group: 'ru.yandex.qatools.ashot',   name: 'ashot',                  version: '1.5.2'
    compile     group: 'com.github.groovy-wslite',  name: 'groovy-wslite',          version: '0.8.0'
    compile     group: 'io.netty',                  name: 'netty-codec-http',       version: '4.0.15.Final'
    compile     group: 'com.google.appengine',      name: 'appengine-api-1.0-sdk',  version: '1.3.1'

    testCompile files("${projectDir}/src/main/groovy")
}

task generateAllureReport(type: Exec) {
    executable 'D:\\allure-commandline\\bin\\allure.bat'
    args('generate', 'build/reports/allure')
}

task runTests(type: Test) {
    include '**/ui/*.*'
}

task runTests3(type: Test) {
    include '**/ui/ExampleTest3.*'
}

task runTests2(type: Test) {
    include '**/ui/ExampleTest2.*'
}

task runSoapApiTests(type: Test) {
    include '**/api/soap/**/*.*'
}

task runRestApiTests(type: Test) {
    include '**/api/rest/**/*.*'
}

new HashSet(tasks.withType(Test)).each {
    System.setProperty('allure.results.directory', 'build/reports/allure')

    it.dependsOn(clean)
    it.ignoreFailures(true)
    it.useJUnit()
    it.systemProperties(System.properties)
    it.jvmArgs "-javaagent:${configurations.agent.singleFile}"
    it.maxParallelForks(System.properties.getProperty('maxParallelForks', '10').toInteger())
    it.finalizedBy(generateAllureReport)
}